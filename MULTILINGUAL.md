# ğŸŒ Multilingual Support

Your Mitra wellness companion now supports **automatic language detection** and can communicate in 15+ languages!

## âœ¨ Features

### Automatic Language Detection
- The app automatically detects which language you're speaking
- No need to manually select your language
- Works seamlessly across all supported languages

### Supported Languages

| Language | Code | Voice Available |
|----------|------|----------------|
| ğŸ‡ºğŸ‡¸ English | en-US | âœ… |
| ğŸ‡ªğŸ‡¸ Spanish | es-ES | âœ… |
| ğŸ‡«ğŸ‡· French | fr-FR | âœ… |
| ğŸ‡©ğŸ‡ª German | de-DE | âœ… |
| ğŸ‡®ğŸ‡³ Hindi | hi-IN | âœ… |
| ğŸ‡¨ğŸ‡³ Chinese | zh-CN | âœ… |
| ğŸ‡¯ğŸ‡µ Japanese | ja-JP | âœ… |
| ğŸ‡¸ğŸ‡¦ Arabic | ar-SA | âœ… |
| ğŸ‡§ğŸ‡· Portuguese | pt-BR | âœ… |
| ğŸ‡®ğŸ‡¹ Italian | it-IT | âœ… |
| ğŸ‡·ğŸ‡º Russian | ru-RU | âœ… |
| ğŸ‡°ğŸ‡· Korean | ko-KR | âœ… |
| ğŸ‡®ğŸ‡³ Bengali | bn-IN | âœ… |
| ğŸ‡®ğŸ‡³ Punjabi | pa-IN | âœ… |
| ğŸ‡µğŸ‡° Urdu | ur-PK | âš ï¸ (fallback) |
| ğŸ‡®ğŸ‡³ Tamil | ta-IN | âœ… |

## ğŸ”§ How It Works

### 1. Speech-to-Text (Automatic Detection)
```javascript
const config = {
    encoding: "WEBM_OPUS",
    sampleRateHertz: 48000,
    languageCode: "en-US", // Primary language
    alternativeLanguageCodes: [
        "es-ES", "fr-FR", "de-DE", "hi-IN",
        "zh-CN", "ja-JP", "ar-SA", "pt-BR",
        // ... and more
    ],
};
```

The Google Cloud Speech-to-Text API automatically detects which language you're speaking and returns the transcription in that language.

### 2. AI Response (Same Language)
```javascript
const enhancedPrompt = `You are Mitra...

User's emotional expression: "${transcription}"

IMPORTANT: The user is speaking in ${languageName}. 
You MUST respond in the SAME language (${languageName}) that the user used.

Respond as a caring AI companion IN ${languageName.toUpperCase()}:`;
```

Gemini 2.0 Flash is instructed to respond in the **same language** as the user input.

### 3. Text-to-Speech (Multilingual Voice)
```javascript
const voiceMapping = {
    "en-US": { name: "en-US-Standard-F", gender: "FEMALE" },
    "es-ES": { name: "es-ES-Standard-A", gender: "FEMALE" },
    "fr-FR": { name: "fr-FR-Standard-A", gender: "FEMALE" },
    // ... mapped for each language
};
```

The voice response is generated in the detected language using native speakers' voices.

## ğŸ“‹ Implementation Details

### Backend Changes (`functions/index.js`)

1. **Speech Recognition with Auto-Detection** (Line 503-541)
   - Added `alternativeLanguageCodes` array with 15+ languages
   - Extracts detected language from API response
   - Stores language in `req.detectedLanguage`

2. **Multilingual AI Prompt** (Line 555-596)
   - Maps language codes to human-readable names
   - Instructs Gemini to respond in the detected language
   - Ensures response matches input language

3. **Multilingual Text-to-Speech** (Line 667-715)
   - Voice mapping for each supported language
   - Uses native voices for each language
   - Automatic fallback to English for unsupported languages

4. **API Response Enhancement** (Line 717-725)
   - Returns `detectedLanguage` code
   - Returns `languageName` for display
   - Helps with debugging and user feedback

### Frontend Changes (`public/app.js`)

1. **Language Detection Logging** (Line 184-187)
   - Logs detected language to console
   - Shows language name in developer tools
   - Helps verify language detection is working

## ğŸš€ Usage

### For Users
1. Click and hold the microphone button
2. Speak in **any supported language**
3. Release the button
4. Mitra will respond in the **same language** you spoke

### For Developers
Check the browser console for language detection:
```
ğŸŒ Language detected: Spanish
ğŸ¤– Response generated by AI
ğŸ”Š Audio response generated successfully in es-ES
```

## ğŸ¯ Testing

### Test Different Languages
1. Say "Hello, how are you?" (English)
2. Say "Hola, Â¿cÃ³mo estÃ¡s?" (Spanish)
3. Say "Bonjour, comment allez-vous?" (French)
4. Say "à¤¨à¤®à¤¸à¥à¤¤à¥‡, à¤†à¤ª à¤•à¥ˆà¤¸à¥‡ à¤¹à¥ˆà¤‚?" (Hindi)
5. Say "ä½ å¥½ï¼Œä½ å¥½å—ï¼Ÿ" (Chinese)

### Verify Detection
Open browser console and look for:
- `ğŸŒ Language detected:` message
- `ğŸ—£ï¸ Speaking in:` log from backend
- Audio player with native language voice

## ğŸ”® Future Enhancements

### Planned Improvements
- [ ] Add more languages (Turkish, Thai, Vietnamese, etc.)
- [ ] Language preference memory (localStorage)
- [ ] Mixed-language conversation support
- [ ] Regional dialect detection
- [ ] Real-time language switching indicator in UI

### Advanced Features
- [ ] Multilingual crisis resources
- [ ] Language-specific therapeutic techniques
- [ ] Cultural context awareness
- [ ] Voice quality improvements per language

## âš ï¸ Notes

### Language Detection Accuracy
- Works best with clear audio and minimal background noise
- Requires at least 2-3 seconds of speech for accurate detection
- May default to English for very short utterances
- Accent variations are generally well-supported

### Voice Quality
- Standard voices are used for all languages
- Some languages have more natural-sounding voices than others
- Google is continuously improving voice quality
- WaveNet voices can be enabled for better quality (higher cost)

## ğŸ“ Support

If you experience issues with language detection:
1. Check microphone quality and noise levels
2. Speak clearly for 3-5 seconds
3. Check browser console for detection logs
4. Verify your language is in the supported list

## ğŸ™ Credits

Powered by:
- **Google Cloud Speech-to-Text** - Automatic language detection
- **Google Gemini 2.0 Flash** - Multilingual AI responses
- **Google Cloud Text-to-Speech** - Native voice synthesis

---

**Made with â¤ï¸ for global mental health and wellbeing**
